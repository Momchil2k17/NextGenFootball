@using NextGenFootball.Web.ViewModels.Coach
@model CoachLineupViewModel

@{
    ViewData["Title"] = "Choose Starting 11";
    var selectedFormation = Model.Formations.FirstOrDefault(f => f.Name == Model.SelectedFormationName) ?? Model.Formations.First();
}

<div class="container my-5">
    <h2 class="text-center mb-4 fw-bold coach-lineup-title">Choose Your Starting 11</h2>

    <div class="row mb-4 justify-content-center">
        <div class="col-md-6">
            <label class="fw-semibold mb-2">Select Formation:</label>
            <select id="formationSelect" class="form-select formation-select">
                @foreach (var formation in Model.Formations)
                {
                    <!option value="@formation.Name" @(formation.Name == Model.SelectedFormationName ? "selected" : "")>
                        @formation.DisplayName
                    </!option>
                }
            </select>
        </div>
    </div>

    <form method="post" asp-area="CoachManagement" asp-controller="Lineup" asp-action="Choose">
        <input type="hidden" id="SelectedFormationName" name="SelectedFormationName" value="@selectedFormation.Name" />

        <div class="lineup-flex">
            <div class="pitch-container mb-4">
                <div id="footballPitch" class="football-pitch"></div>
            </div>
            <div class="player-list-container">
                <h5 class="mb-3 fw-bold text-center">Available Players</h5>
                <div id="playerList" class="player-list"></div>
            </div>
        </div>

        <div id="lineupInputs"></div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-success btn-lg fw-bold">
                <i class="bi bi-check2-circle"></i> Save Lineup
            </button>
        </div>
    </form>
</div>

<link rel="stylesheet" href="~/css/coach-lineup.css" />
<script src="~/js/coachLineupDragDrop.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<script>
    window.lineupPlayers = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Players));
    window.formations = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Formations));
    window.selectedFormationName = "@selectedFormation.Name";
</script>